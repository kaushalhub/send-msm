"use strict";

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _uuid = require("uuid");

var _uuid2 = _interopRequireDefault(_uuid);

var _jsonwebtoken = require("jsonwebtoken");

var _jsonwebtoken2 = _interopRequireDefault(_jsonwebtoken);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var JwtGenerator = function () {
  function JwtGenerator() {
    _classCallCheck(this, JwtGenerator);
  }

  _createClass(JwtGenerator, [{
    key: "generate",

    /**
     * Generate a JSON Web Token (JWT).
     *
     * @param {Buffer} cert - the private key certificate to be used when signing
     * the claims.
     * @param {Object} claims - additional claims to include within the generated
     * JWT.
     *
     * @returns {String} the generated token
     */
    value: function generate(cert) {
      var claims = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

      if (!(cert instanceof Buffer)) {
        throw new Error("cert must be of type Buffer");
      }
      if ((typeof claims === "undefined" ? "undefined" : _typeof(claims)) !== "object") {
        throw new Error("claims must be of type object");
      }

      var toSign = {
        iat: claims.issuedAt || parseInt(Date.now() / 1000, 10),
        jti: claims.jti || _uuid2.default.v1()
      };
      Object.keys(claims).forEach(function (key) {
        toSign[key] = claims[key];
      });

      var token = _jsonwebtoken2.default.sign(toSign, cert, { algorithm: "RS256" });
      return token;
    }
  }]);

  return JwtGenerator;
}();

module.exports = JwtGenerator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9Kd3RHZW5lcmF0b3IuanMiXSwibmFtZXMiOlsiSnd0R2VuZXJhdG9yIiwiY2VydCIsImNsYWltcyIsIkJ1ZmZlciIsIkVycm9yIiwidG9TaWduIiwiaWF0IiwiaXNzdWVkQXQiLCJwYXJzZUludCIsIkRhdGUiLCJub3ciLCJqdGkiLCJ1dWlkIiwidjEiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsImtleSIsInRva2VuIiwiand0Iiwic2lnbiIsImFsZ29yaXRobSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBOzs7O0FBQ0E7Ozs7Ozs7O0lBRU1BLFk7Ozs7Ozs7O0FBQ0o7Ozs7Ozs7Ozs7NkJBVVNDLEksRUFBbUI7QUFBQSxVQUFiQyxNQUFhLHVFQUFKLEVBQUk7O0FBQzFCLFVBQUksRUFBRUQsZ0JBQWdCRSxNQUFsQixDQUFKLEVBQStCO0FBQzdCLGNBQU0sSUFBSUMsS0FBSixDQUFVLDZCQUFWLENBQU47QUFDRDtBQUNELFVBQUksUUFBT0YsTUFBUCx5Q0FBT0EsTUFBUCxPQUFrQixRQUF0QixFQUFnQztBQUM5QixjQUFNLElBQUlFLEtBQUosQ0FBVSwrQkFBVixDQUFOO0FBQ0Q7O0FBRUQsVUFBSUMsU0FBUztBQUNYQyxhQUFLSixPQUFPSyxRQUFQLElBQW1CQyxTQUFTQyxLQUFLQyxHQUFMLEtBQWEsSUFBdEIsRUFBNEIsRUFBNUIsQ0FEYjtBQUVYQyxhQUFLVCxPQUFPUyxHQUFQLElBQWNDLGVBQUtDLEVBQUw7QUFGUixPQUFiO0FBSUFDLGFBQU9DLElBQVAsQ0FBWWIsTUFBWixFQUFvQmMsT0FBcEIsQ0FBNEIsZUFBTztBQUNqQ1gsZUFBT1ksR0FBUCxJQUFjZixPQUFPZSxHQUFQLENBQWQ7QUFDRCxPQUZEOztBQUlBLFVBQUlDLFFBQVFDLHVCQUFJQyxJQUFKLENBQVNmLE1BQVQsRUFBaUJKLElBQWpCLEVBQXVCLEVBQUVvQixXQUFXLE9BQWIsRUFBdkIsQ0FBWjtBQUNBLGFBQU9ILEtBQVA7QUFDRDs7Ozs7O0FBR0hJLE9BQU9DLE9BQVAsR0FBaUJ2QixZQUFqQiIsImZpbGUiOiJKd3RHZW5lcmF0b3IuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdXVpZCBmcm9tIFwidXVpZFwiO1xuaW1wb3J0IGp3dCBmcm9tIFwianNvbndlYnRva2VuXCI7XG5cbmNsYXNzIEp3dEdlbmVyYXRvciB7XG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBhIEpTT04gV2ViIFRva2VuIChKV1QpLlxuICAgKlxuICAgKiBAcGFyYW0ge0J1ZmZlcn0gY2VydCAtIHRoZSBwcml2YXRlIGtleSBjZXJ0aWZpY2F0ZSB0byBiZSB1c2VkIHdoZW4gc2lnbmluZ1xuICAgKiB0aGUgY2xhaW1zLlxuICAgKiBAcGFyYW0ge09iamVjdH0gY2xhaW1zIC0gYWRkaXRpb25hbCBjbGFpbXMgdG8gaW5jbHVkZSB3aXRoaW4gdGhlIGdlbmVyYXRlZFxuICAgKiBKV1QuXG4gICAqXG4gICAqIEByZXR1cm5zIHtTdHJpbmd9IHRoZSBnZW5lcmF0ZWQgdG9rZW5cbiAgICovXG4gIGdlbmVyYXRlKGNlcnQsIGNsYWltcyA9IHt9KSB7XG4gICAgaWYgKCEoY2VydCBpbnN0YW5jZW9mIEJ1ZmZlcikpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcImNlcnQgbXVzdCBiZSBvZiB0eXBlIEJ1ZmZlclwiKTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBjbGFpbXMgIT09IFwib2JqZWN0XCIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcImNsYWltcyBtdXN0IGJlIG9mIHR5cGUgb2JqZWN0XCIpO1xuICAgIH1cblxuICAgIHZhciB0b1NpZ24gPSB7XG4gICAgICBpYXQ6IGNsYWltcy5pc3N1ZWRBdCB8fCBwYXJzZUludChEYXRlLm5vdygpIC8gMTAwMCwgMTApLFxuICAgICAganRpOiBjbGFpbXMuanRpIHx8IHV1aWQudjEoKVxuICAgIH07XG4gICAgT2JqZWN0LmtleXMoY2xhaW1zKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICB0b1NpZ25ba2V5XSA9IGNsYWltc1trZXldO1xuICAgIH0pO1xuXG4gICAgdmFyIHRva2VuID0gand0LnNpZ24odG9TaWduLCBjZXJ0LCB7IGFsZ29yaXRobTogXCJSUzI1NlwiIH0pO1xuICAgIHJldHVybiB0b2tlbjtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEp3dEdlbmVyYXRvcjtcbiJdfQ==